{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/hide-on-scroll.js"],"names":[],"mappings":"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","file":"../src/hide-on-scroll.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","// HIDE ON SCROLL\r\n// ==============\r\n\r\n// Constants\r\n// ---------\r\n\r\nconst defaultOptions  = {\r\n    delay: 2000,\r\n    position: 0,\r\n    selector: '.hide-on-scroll'\r\n};\r\n\r\nconst attrDelay       = 'data-hide-delay';\r\nconst attrPosition    = 'data-hide-position';\r\n\r\nconst classHidden     = 'is-hidden-on-scroll';\r\nconst classLocked     = 'is-locked';\r\nconst classNoAnim     = 'no-anim';\r\nconst classTop        = 'at-top';\r\n\r\n// Static Members\r\n// --------------\r\n\r\nlet _instanceCount = 0;\r\nlet _isScrollingUpwards = false;\r\nlet _scrollPosition = window.scrollY || window.pageYOffset;\r\n\r\n// Utility Methods\r\n// ---------------\r\n\r\nfunction assign(target, firstSource) {\r\n    if (target === undefined || target === null) {\r\n        throw new TypeError('Cannot convert first argument to object');\r\n    }\r\n    var to = Object(target);\r\n    for (var i = 1; i < arguments.length; i++) {\r\n        var nextSource = arguments[i];\r\n        if (nextSource === undefined || nextSource === null) {\r\n            continue;\r\n        }\r\n        var keysArray = Object.keys(Object(nextSource));\r\n        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {\r\n            var nextKey = keysArray[nextIndex];\r\n            var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);\r\n            if (desc !== undefined && desc.enumerable) {\r\n                to[nextKey] = nextSource[nextKey];\r\n            }\r\n        }\r\n    }\r\n    return to;\r\n}\r\n\r\nfunction toggleClass(element, className, force) {\r\n    if (force) {\r\n        element.classList.add(className);\r\n    } else {\r\n        element.classList.remove(className);\r\n    }\r\n}\r\n\r\n// HideOnScroll\r\n// ------------\r\n\r\nexport default class HideOnScroll {\r\n\r\n    static get instanceCount() { return _instanceCount; }\r\n    static get isScrollingUpwards() { return _isScrollingUpwards; }\r\n    static get scrollPosition() { return _isScrollingUpwards; }\r\n\r\n    get items() { return this._items; }\r\n    get options() { return this._options; }\r\n\r\n    constructor (options = {}) {\r\n        // Options\r\n        this._options = assign({}, defaultOptions, options);\r\n        // Items\r\n        this._items = [];\r\n        let nodeList = document.querySelectorAll(this._options.selector);\r\n        for (let i = 0; i < nodeList.length; i++) {\r\n            this._items.push(new HideOnScrollItem(this, nodeList[i]));\r\n        }\r\n        // On Scroll\r\n        if (_instanceCount == 0) {\r\n            window.addEventListener('scroll', (e) => {\r\n                this.refresh(e);\r\n            });\r\n        }\r\n        _instanceCount++;\r\n    }\r\n\r\n    refresh(e) {\r\n        let position = window.scrollY || window.pageYOffset;\r\n        if (position == _scrollPosition) return;\r\n        toggleClass(document.body, classTop, (position <= 0));\r\n        _isScrollingUpwards = (position < _scrollPosition || position <= 0)\r\n        _scrollPosition = position;\r\n        for (let i = 0; i < this._items.length; i++) this._items[i].refresh();\r\n    }\r\n\r\n}\r\n\r\n// HideOnScrollItem\r\n// ----------------\r\n\r\nclass HideOnScrollItem {\r\n\r\n    get element() { return this._element; }\r\n    get options() { return this._options; }\r\n    get parent() { return this._parent; }\r\n\r\n    constructor(parent, element) {\r\n        this._parent = parent;\r\n        this._element = element;\r\n        this._options = assign({}, parent._options);\r\n        this._setOptionInt('delay', attrDelay);\r\n        this._setOptionInt('position', attrPosition);\r\n        this._mouseOver = false;\r\n        if (!(\"ontouchstart\" in document.documentElement)) {\r\n            document.addEventListener('mousemove', (e) => { this.onMouseMove(e) });\r\n            element.addEventListener('mouseenter', () => { this._mouseOver = true });\r\n            element.addEventListener('mouseleave', () => { this._mouseOver = false });\r\n        }\r\n    }\r\n\r\n    clearTimeout() {\r\n        clearTimeout(this._timeoutId);\r\n        this._timeoutId = undefined;\r\n    }\r\n\r\n    hide() {\r\n        if (_scrollPosition <= this._options.position || this._element.classList.contains(classLocked)) return;\r\n        this._timeoutId = undefined;\r\n        this._element.classList.add(classHidden);\r\n    }\r\n\r\n    onMouseMove(e) {\r\n        let y = this._element.getBoundingClientRect().height\r\n        let show = (e.clientY <= y);\r\n        if ((this._showOnMouse != show)) { // state changed\r\n            this._showOnMouse = show;\r\n            if (show) {\r\n                this.clearTimeout();\r\n                this._element.classList.remove(classHidden);\r\n            } else if (this._timeoutId == undefined) {\r\n                this._timeoutId = setTimeout(() => { this.hide() }, this._options.delay);\r\n            }\r\n        }\r\n    }\r\n\r\n    refresh() {\r\n        this.clearTimeout();\r\n        this._element.classList.remove(classNoAnim);\r\n        let show = (_isScrollingUpwards || _scrollPosition <= this._options.position || this._element.classList.contains(classLocked) || this._mouseOver);\r\n        if (show) {\r\n            this._element.classList.remove(classHidden);\r\n            if (!this._mouseOver) this._timeoutId = setTimeout(() => { this.hide() }, this._options.delay);\r\n        } else if (this._timeoutId == undefined) {\r\n            this._element.classList.add(classHidden);\r\n        }\r\n    }\r\n\r\n    _setOptionInt(option, attr) {\r\n        let value = this._element.getAttribute(attr);\r\n        if (value) {\r\n            this._options[option] = parseInt(value);\r\n        }\r\n    }\r\n\r\n}\r\n\r\n// Globals\r\n// -------\r\n\r\nwindow.HideOnScroll = HideOnScroll;"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvaGlkZS1vbi1zY3JvbGwuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7O0FDQUE7QUFDQTtBQUVBO0FBQ0E7QUFFQSxJQUFNLGNBQWMsR0FBSTtBQUNwQixFQUFBLEtBQUssRUFBRSxJQURhO0FBRXBCLEVBQUEsUUFBUSxFQUFFLENBRlU7QUFHcEIsRUFBQSxRQUFRLEVBQUU7QUFIVSxDQUF4QjtBQU1BLElBQU0sU0FBUyxHQUFTLGlCQUF4QjtBQUNBLElBQU0sWUFBWSxHQUFNLG9CQUF4QjtBQUVBLElBQU0sV0FBVyxHQUFPLHFCQUF4QjtBQUNBLElBQU0sV0FBVyxHQUFPLFdBQXhCO0FBQ0EsSUFBTSxXQUFXLEdBQU8sU0FBeEI7QUFDQSxJQUFNLFFBQVEsR0FBVSxRQUF4QixDLENBRUE7QUFDQTs7QUFFQSxJQUFJLGNBQWMsR0FBRyxDQUFyQjtBQUNBLElBQUksbUJBQW1CLEdBQUcsS0FBMUI7O0FBQ0EsSUFBSSxlQUFlLEdBQUcsTUFBTSxDQUFDLE9BQVAsSUFBa0IsTUFBTSxDQUFDLFdBQS9DLEMsQ0FFQTtBQUNBOzs7QUFFQSxTQUFTLE1BQVQsQ0FBZ0IsTUFBaEIsRUFBd0IsV0FBeEIsRUFBcUM7QUFDakMsTUFBSSxNQUFNLEtBQUssU0FBWCxJQUF3QixNQUFNLEtBQUssSUFBdkMsRUFBNkM7QUFDekMsVUFBTSxJQUFJLFNBQUosQ0FBYyx5Q0FBZCxDQUFOO0FBQ0g7O0FBQ0QsTUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLE1BQUQsQ0FBZjs7QUFDQSxPQUFLLElBQUksQ0FBQyxHQUFHLENBQWIsRUFBZ0IsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUE5QixFQUFzQyxDQUFDLEVBQXZDLEVBQTJDO0FBQ3ZDLFFBQUksVUFBVSxHQUFHLFNBQVMsQ0FBQyxDQUFELENBQTFCOztBQUNBLFFBQUksVUFBVSxLQUFLLFNBQWYsSUFBNEIsVUFBVSxLQUFLLElBQS9DLEVBQXFEO0FBQ2pEO0FBQ0g7O0FBQ0QsUUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLElBQVAsQ0FBWSxNQUFNLENBQUMsVUFBRCxDQUFsQixDQUFoQjs7QUFDQSxTQUFLLElBQUksU0FBUyxHQUFHLENBQWhCLEVBQW1CLEdBQUcsR0FBRyxTQUFTLENBQUMsTUFBeEMsRUFBZ0QsU0FBUyxHQUFHLEdBQTVELEVBQWlFLFNBQVMsRUFBMUUsRUFBOEU7QUFDMUUsVUFBSSxPQUFPLEdBQUcsU0FBUyxDQUFDLFNBQUQsQ0FBdkI7QUFDQSxVQUFJLElBQUksR0FBRyxNQUFNLENBQUMsd0JBQVAsQ0FBZ0MsVUFBaEMsRUFBNEMsT0FBNUMsQ0FBWDs7QUFDQSxVQUFJLElBQUksS0FBSyxTQUFULElBQXNCLElBQUksQ0FBQyxVQUEvQixFQUEyQztBQUN2QyxRQUFBLEVBQUUsQ0FBQyxPQUFELENBQUYsR0FBYyxVQUFVLENBQUMsT0FBRCxDQUF4QjtBQUNIO0FBQ0o7QUFDSjs7QUFDRCxTQUFPLEVBQVA7QUFDSDs7QUFFRCxTQUFTLFdBQVQsQ0FBcUIsT0FBckIsRUFBOEIsU0FBOUIsRUFBeUMsS0FBekMsRUFBZ0Q7QUFDNUMsTUFBSSxLQUFKLEVBQVc7QUFDUCxJQUFBLE9BQU8sQ0FBQyxTQUFSLENBQWtCLEdBQWxCLENBQXNCLFNBQXRCO0FBQ0gsR0FGRCxNQUVPO0FBQ0gsSUFBQSxPQUFPLENBQUMsU0FBUixDQUFrQixNQUFsQixDQUF5QixTQUF6QjtBQUNIO0FBQ0osQyxDQUVEO0FBQ0E7OztJQUVxQixZOzs7Ozt3QkFNTDtBQUFFLGFBQU8sS0FBSyxNQUFaO0FBQXFCOzs7d0JBQ3JCO0FBQUUsYUFBTyxLQUFLLFFBQVo7QUFBdUI7Ozt3QkFMWjtBQUFFLGFBQU8sY0FBUDtBQUF3Qjs7O3dCQUNyQjtBQUFFLGFBQU8sbUJBQVA7QUFBNkI7Ozt3QkFDbkM7QUFBRSxhQUFPLG1CQUFQO0FBQTZCOzs7QUFLM0QsMEJBQTJCO0FBQUE7O0FBQUEsUUFBZCxPQUFjLHVFQUFKLEVBQUk7O0FBQUE7O0FBQ3ZCO0FBQ0EsU0FBSyxRQUFMLEdBQWdCLE1BQU0sQ0FBQyxFQUFELEVBQUssY0FBTCxFQUFxQixPQUFyQixDQUF0QixDQUZ1QixDQUd2Qjs7QUFDQSxTQUFLLE1BQUwsR0FBYyxFQUFkO0FBQ0EsUUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLGdCQUFULENBQTBCLEtBQUssUUFBTCxDQUFjLFFBQXhDLENBQWY7O0FBQ0EsU0FBSyxJQUFJLENBQUMsR0FBRyxDQUFiLEVBQWdCLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBN0IsRUFBcUMsQ0FBQyxFQUF0QyxFQUEwQztBQUN0QyxXQUFLLE1BQUwsQ0FBWSxJQUFaLENBQWlCLElBQUksZ0JBQUosQ0FBcUIsSUFBckIsRUFBMkIsUUFBUSxDQUFDLENBQUQsQ0FBbkMsQ0FBakI7QUFDSCxLQVJzQixDQVN2Qjs7O0FBQ0EsUUFBSSxjQUFjLElBQUksQ0FBdEIsRUFBeUI7QUFDckIsTUFBQSxNQUFNLENBQUMsZ0JBQVAsQ0FBd0IsUUFBeEIsRUFBa0MsVUFBQyxDQUFELEVBQU87QUFDckMsUUFBQSxLQUFJLENBQUMsT0FBTCxDQUFhLENBQWI7QUFDSCxPQUZEO0FBR0g7O0FBQ0QsSUFBQSxjQUFjO0FBQ2pCOzs7OzRCQUVPLEMsRUFBRztBQUNQLFVBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxPQUFQLElBQWtCLE1BQU0sQ0FBQyxXQUF4QztBQUNBLFVBQUksUUFBUSxJQUFJLGVBQWhCLEVBQWlDO0FBQ2pDLE1BQUEsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFWLEVBQWdCLFFBQWhCLEVBQTJCLFFBQVEsSUFBSSxDQUF2QyxDQUFYO0FBQ0EsTUFBQSxtQkFBbUIsR0FBSSxRQUFRLEdBQUcsZUFBWCxJQUE4QixRQUFRLElBQUksQ0FBakU7QUFDQSxNQUFBLGVBQWUsR0FBRyxRQUFsQjs7QUFDQSxXQUFLLElBQUksQ0FBQyxHQUFHLENBQWIsRUFBZ0IsQ0FBQyxHQUFHLEtBQUssTUFBTCxDQUFZLE1BQWhDLEVBQXdDLENBQUMsRUFBekM7QUFBNkMsYUFBSyxNQUFMLENBQVksQ0FBWixFQUFlLE9BQWY7QUFBN0M7QUFDSDs7OztLQUlMO0FBQ0E7Ozs7O0lBRU0sZ0I7Ozs7O3dCQUVZO0FBQUUsYUFBTyxLQUFLLFFBQVo7QUFBdUI7Ozt3QkFDekI7QUFBRSxhQUFPLEtBQUssUUFBWjtBQUF1Qjs7O3dCQUMxQjtBQUFFLGFBQU8sS0FBSyxPQUFaO0FBQXNCOzs7QUFFckMsNEJBQVksTUFBWixFQUFvQixPQUFwQixFQUE2QjtBQUFBOztBQUFBOztBQUN6QixTQUFLLE9BQUwsR0FBZSxNQUFmO0FBQ0EsU0FBSyxRQUFMLEdBQWdCLE9BQWhCO0FBQ0EsU0FBSyxRQUFMLEdBQWdCLE1BQU0sQ0FBQyxFQUFELEVBQUssTUFBTSxDQUFDLFFBQVosQ0FBdEI7O0FBQ0EsU0FBSyxhQUFMLENBQW1CLE9BQW5CLEVBQTRCLFNBQTVCOztBQUNBLFNBQUssYUFBTCxDQUFtQixVQUFuQixFQUErQixZQUEvQjs7QUFDQSxTQUFLLFVBQUwsR0FBa0IsS0FBbEI7O0FBQ0EsUUFBSSxFQUFFLGtCQUFrQixRQUFRLENBQUMsZUFBN0IsQ0FBSixFQUFtRDtBQUMvQyxNQUFBLFFBQVEsQ0FBQyxnQkFBVCxDQUEwQixXQUExQixFQUF1QyxVQUFDLENBQUQsRUFBTztBQUFFLFFBQUEsTUFBSSxDQUFDLFdBQUwsQ0FBaUIsQ0FBakI7QUFBcUIsT0FBckU7QUFDQSxNQUFBLE9BQU8sQ0FBQyxnQkFBUixDQUF5QixZQUF6QixFQUF1QyxZQUFNO0FBQUUsUUFBQSxNQUFJLENBQUMsVUFBTCxHQUFrQixJQUFsQjtBQUF3QixPQUF2RTtBQUNBLE1BQUEsT0FBTyxDQUFDLGdCQUFSLENBQXlCLFlBQXpCLEVBQXVDLFlBQU07QUFBRSxRQUFBLE1BQUksQ0FBQyxVQUFMLEdBQWtCLEtBQWxCO0FBQXlCLE9BQXhFO0FBQ0g7QUFDSjs7Ozs7Ozs7Ozs7Ozs7a0JBRWM7QUFDWCxNQUFBLFlBQVksQ0FBQyxLQUFLLFVBQU4sQ0FBWjtBQUNBLFdBQUssVUFBTCxHQUFrQixTQUFsQjtBQUNILEs7OzsyQkFFTTtBQUNILFVBQUksZUFBZSxJQUFJLEtBQUssUUFBTCxDQUFjLFFBQWpDLElBQTZDLEtBQUssUUFBTCxDQUFjLFNBQWQsQ0FBd0IsUUFBeEIsQ0FBaUMsV0FBakMsQ0FBakQsRUFBZ0c7QUFDaEcsV0FBSyxVQUFMLEdBQWtCLFNBQWxCOztBQUNBLFdBQUssUUFBTCxDQUFjLFNBQWQsQ0FBd0IsR0FBeEIsQ0FBNEIsV0FBNUI7QUFDSDs7O2dDQUVXLEMsRUFBRztBQUFBOztBQUNYLFVBQUksQ0FBQyxHQUFHLEtBQUssUUFBTCxDQUFjLHFCQUFkLEdBQXNDLE1BQTlDOztBQUNBLFVBQUksSUFBSSxHQUFJLENBQUMsQ0FBQyxPQUFGLElBQWEsQ0FBekI7O0FBQ0EsVUFBSyxLQUFLLFlBQUwsSUFBcUIsSUFBMUIsRUFBaUM7QUFBRTtBQUMvQixhQUFLLFlBQUwsR0FBb0IsSUFBcEI7O0FBQ0EsWUFBSSxJQUFKLEVBQVU7QUFDTixlQUFLLFlBQUw7O0FBQ0EsZUFBSyxRQUFMLENBQWMsU0FBZCxDQUF3QixNQUF4QixDQUErQixXQUEvQjtBQUNILFNBSEQsTUFHTyxJQUFJLEtBQUssVUFBTCxJQUFtQixTQUF2QixFQUFrQztBQUNyQyxlQUFLLFVBQUwsR0FBa0IsVUFBVSxDQUFDLFlBQU07QUFBRSxZQUFBLE1BQUksQ0FBQyxJQUFMO0FBQWEsV0FBdEIsRUFBd0IsS0FBSyxRQUFMLENBQWMsS0FBdEMsQ0FBNUI7QUFDSDtBQUNKO0FBQ0o7Ozs4QkFFUztBQUFBOztBQUNOLFdBQUssWUFBTDs7QUFDQSxXQUFLLFFBQUwsQ0FBYyxTQUFkLENBQXdCLE1BQXhCLENBQStCLFdBQS9COztBQUNBLFVBQUksSUFBSSxHQUFJLG1CQUFtQixJQUFJLGVBQWUsSUFBSSxLQUFLLFFBQUwsQ0FBYyxRQUF4RCxJQUFvRSxLQUFLLFFBQUwsQ0FBYyxTQUFkLENBQXdCLFFBQXhCLENBQWlDLFdBQWpDLENBQXBFLElBQXFILEtBQUssVUFBdEk7O0FBQ0EsVUFBSSxJQUFKLEVBQVU7QUFDTixhQUFLLFFBQUwsQ0FBYyxTQUFkLENBQXdCLE1BQXhCLENBQStCLFdBQS9COztBQUNBLFlBQUksQ0FBQyxLQUFLLFVBQVYsRUFBc0IsS0FBSyxVQUFMLEdBQWtCLFVBQVUsQ0FBQyxZQUFNO0FBQUUsVUFBQSxNQUFJLENBQUMsSUFBTDtBQUFhLFNBQXRCLEVBQXdCLEtBQUssUUFBTCxDQUFjLEtBQXRDLENBQTVCO0FBQ3pCLE9BSEQsTUFHTyxJQUFJLEtBQUssVUFBTCxJQUFtQixTQUF2QixFQUFrQztBQUNyQyxhQUFLLFFBQUwsQ0FBYyxTQUFkLENBQXdCLEdBQXhCLENBQTRCLFdBQTVCO0FBQ0g7QUFDSjs7O2tDQUVhLE0sRUFBUSxJLEVBQU07QUFDeEIsVUFBSSxLQUFLLEdBQUcsS0FBSyxRQUFMLENBQWMsWUFBZCxDQUEyQixJQUEzQixDQUFaOztBQUNBLFVBQUksS0FBSixFQUFXO0FBQ1AsYUFBSyxRQUFMLENBQWMsTUFBZCxJQUF3QixRQUFRLENBQUMsS0FBRCxDQUFoQztBQUNIO0FBQ0o7Ozs7S0FJTDtBQUNBOzs7QUFFQSxNQUFNLENBQUMsWUFBUCxHQUFzQixZQUF0QiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIi8vIEhJREUgT04gU0NST0xMXHJcbi8vID09PT09PT09PT09PT09XHJcblxyXG4vLyBDb25zdGFudHNcclxuLy8gLS0tLS0tLS0tXHJcblxyXG5jb25zdCBkZWZhdWx0T3B0aW9ucyAgPSB7XHJcbiAgICBkZWxheTogMjAwMCxcclxuICAgIHBvc2l0aW9uOiAwLFxyXG4gICAgc2VsZWN0b3I6ICcuaGlkZS1vbi1zY3JvbGwnXHJcbn07XHJcblxyXG5jb25zdCBhdHRyRGVsYXkgICAgICAgPSAnZGF0YS1oaWRlLWRlbGF5JztcclxuY29uc3QgYXR0clBvc2l0aW9uICAgID0gJ2RhdGEtaGlkZS1wb3NpdGlvbic7XHJcblxyXG5jb25zdCBjbGFzc0hpZGRlbiAgICAgPSAnaXMtaGlkZGVuLW9uLXNjcm9sbCc7XHJcbmNvbnN0IGNsYXNzTG9ja2VkICAgICA9ICdpcy1sb2NrZWQnO1xyXG5jb25zdCBjbGFzc05vQW5pbSAgICAgPSAnbm8tYW5pbSc7XHJcbmNvbnN0IGNsYXNzVG9wICAgICAgICA9ICdhdC10b3AnO1xyXG5cclxuLy8gU3RhdGljIE1lbWJlcnNcclxuLy8gLS0tLS0tLS0tLS0tLS1cclxuXHJcbmxldCBfaW5zdGFuY2VDb3VudCA9IDA7XHJcbmxldCBfaXNTY3JvbGxpbmdVcHdhcmRzID0gZmFsc2U7XHJcbmxldCBfc2Nyb2xsUG9zaXRpb24gPSB3aW5kb3cuc2Nyb2xsWSB8fCB3aW5kb3cucGFnZVlPZmZzZXQ7XHJcblxyXG4vLyBVdGlsaXR5IE1ldGhvZHNcclxuLy8gLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5mdW5jdGlvbiBhc3NpZ24odGFyZ2V0LCBmaXJzdFNvdXJjZSkge1xyXG4gICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IHRhcmdldCA9PT0gbnVsbCkge1xyXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0IGZpcnN0IGFyZ3VtZW50IHRvIG9iamVjdCcpO1xyXG4gICAgfVxyXG4gICAgdmFyIHRvID0gT2JqZWN0KHRhcmdldCk7XHJcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhciBuZXh0U291cmNlID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgIGlmIChuZXh0U291cmNlID09PSB1bmRlZmluZWQgfHwgbmV4dFNvdXJjZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGtleXNBcnJheSA9IE9iamVjdC5rZXlzKE9iamVjdChuZXh0U291cmNlKSk7XHJcbiAgICAgICAgZm9yICh2YXIgbmV4dEluZGV4ID0gMCwgbGVuID0ga2V5c0FycmF5Lmxlbmd0aDsgbmV4dEluZGV4IDwgbGVuOyBuZXh0SW5kZXgrKykge1xyXG4gICAgICAgICAgICB2YXIgbmV4dEtleSA9IGtleXNBcnJheVtuZXh0SW5kZXhdO1xyXG4gICAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobmV4dFNvdXJjZSwgbmV4dEtleSk7XHJcbiAgICAgICAgICAgIGlmIChkZXNjICE9PSB1bmRlZmluZWQgJiYgZGVzYy5lbnVtZXJhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICB0b1tuZXh0S2V5XSA9IG5leHRTb3VyY2VbbmV4dEtleV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG87XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZUNsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSwgZm9yY2UpIHtcclxuICAgIGlmIChmb3JjZSkge1xyXG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcclxuICAgIH1cclxufVxyXG5cclxuLy8gSGlkZU9uU2Nyb2xsXHJcbi8vIC0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSGlkZU9uU2Nyb2xsIHtcclxuXHJcbiAgICBzdGF0aWMgZ2V0IGluc3RhbmNlQ291bnQoKSB7IHJldHVybiBfaW5zdGFuY2VDb3VudDsgfVxyXG4gICAgc3RhdGljIGdldCBpc1Njcm9sbGluZ1Vwd2FyZHMoKSB7IHJldHVybiBfaXNTY3JvbGxpbmdVcHdhcmRzOyB9XHJcbiAgICBzdGF0aWMgZ2V0IHNjcm9sbFBvc2l0aW9uKCkgeyByZXR1cm4gX2lzU2Nyb2xsaW5nVXB3YXJkczsgfVxyXG5cclxuICAgIGdldCBpdGVtcygpIHsgcmV0dXJuIHRoaXMuX2l0ZW1zOyB9XHJcbiAgICBnZXQgb3B0aW9ucygpIHsgcmV0dXJuIHRoaXMuX29wdGlvbnM7IH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvciAob3B0aW9ucyA9IHt9KSB7XHJcbiAgICAgICAgLy8gT3B0aW9uc1xyXG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBhc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcclxuICAgICAgICAvLyBJdGVtc1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zID0gW107XHJcbiAgICAgICAgbGV0IG5vZGVMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9vcHRpb25zLnNlbGVjdG9yKTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVMaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnB1c2gobmV3IEhpZGVPblNjcm9sbEl0ZW0odGhpcywgbm9kZUxpc3RbaV0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gT24gU2Nyb2xsXHJcbiAgICAgICAgaWYgKF9pbnN0YW5jZUNvdW50ID09IDApIHtcclxuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBfaW5zdGFuY2VDb3VudCsrO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZnJlc2goZSkge1xyXG4gICAgICAgIGxldCBwb3NpdGlvbiA9IHdpbmRvdy5zY3JvbGxZIHx8IHdpbmRvdy5wYWdlWU9mZnNldDtcclxuICAgICAgICBpZiAocG9zaXRpb24gPT0gX3Njcm9sbFBvc2l0aW9uKSByZXR1cm47XHJcbiAgICAgICAgdG9nZ2xlQ2xhc3MoZG9jdW1lbnQuYm9keSwgY2xhc3NUb3AsIChwb3NpdGlvbiA8PSAwKSk7XHJcbiAgICAgICAgX2lzU2Nyb2xsaW5nVXB3YXJkcyA9IChwb3NpdGlvbiA8IF9zY3JvbGxQb3NpdGlvbiB8fCBwb3NpdGlvbiA8PSAwKVxyXG4gICAgICAgIF9zY3JvbGxQb3NpdGlvbiA9IHBvc2l0aW9uO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5faXRlbXMubGVuZ3RoOyBpKyspIHRoaXMuX2l0ZW1zW2ldLnJlZnJlc2goKTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbi8vIEhpZGVPblNjcm9sbEl0ZW1cclxuLy8gLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuY2xhc3MgSGlkZU9uU2Nyb2xsSXRlbSB7XHJcblxyXG4gICAgZ2V0IGVsZW1lbnQoKSB7IHJldHVybiB0aGlzLl9lbGVtZW50OyB9XHJcbiAgICBnZXQgb3B0aW9ucygpIHsgcmV0dXJuIHRoaXMuX29wdGlvbnM7IH1cclxuICAgIGdldCBwYXJlbnQoKSB7IHJldHVybiB0aGlzLl9wYXJlbnQ7IH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQsIGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7XHJcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IGFzc2lnbih7fSwgcGFyZW50Ll9vcHRpb25zKTtcclxuICAgICAgICB0aGlzLl9zZXRPcHRpb25JbnQoJ2RlbGF5JywgYXR0ckRlbGF5KTtcclxuICAgICAgICB0aGlzLl9zZXRPcHRpb25JbnQoJ3Bvc2l0aW9uJywgYXR0clBvc2l0aW9uKTtcclxuICAgICAgICB0aGlzLl9tb3VzZU92ZXIgPSBmYWxzZTtcclxuICAgICAgICBpZiAoIShcIm9udG91Y2hzdGFydFwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkpIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgKGUpID0+IHsgdGhpcy5vbk1vdXNlTW92ZShlKSB9KTtcclxuICAgICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgKCkgPT4geyB0aGlzLl9tb3VzZU92ZXIgPSB0cnVlIH0pO1xyXG4gICAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoKSA9PiB7IHRoaXMuX21vdXNlT3ZlciA9IGZhbHNlIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhclRpbWVvdXQoKSB7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVvdXRJZCk7XHJcbiAgICAgICAgdGhpcy5fdGltZW91dElkID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIGhpZGUoKSB7XHJcbiAgICAgICAgaWYgKF9zY3JvbGxQb3NpdGlvbiA8PSB0aGlzLl9vcHRpb25zLnBvc2l0aW9uIHx8IHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzTG9ja2VkKSkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMuX3RpbWVvdXRJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NIaWRkZW4pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uTW91c2VNb3ZlKGUpIHtcclxuICAgICAgICBsZXQgeSA9IHRoaXMuX2VsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0XHJcbiAgICAgICAgbGV0IHNob3cgPSAoZS5jbGllbnRZIDw9IHkpO1xyXG4gICAgICAgIGlmICgodGhpcy5fc2hvd09uTW91c2UgIT0gc2hvdykpIHsgLy8gc3RhdGUgY2hhbmdlZFxyXG4gICAgICAgICAgICB0aGlzLl9zaG93T25Nb3VzZSA9IHNob3c7XHJcbiAgICAgICAgICAgIGlmIChzaG93KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyVGltZW91dCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzSGlkZGVuKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl90aW1lb3V0SWQgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHsgdGhpcy5oaWRlKCkgfSwgdGhpcy5fb3B0aW9ucy5kZWxheSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVmcmVzaCgpIHtcclxuICAgICAgICB0aGlzLmNsZWFyVGltZW91dCgpO1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05vQW5pbSk7XHJcbiAgICAgICAgbGV0IHNob3cgPSAoX2lzU2Nyb2xsaW5nVXB3YXJkcyB8fCBfc2Nyb2xsUG9zaXRpb24gPD0gdGhpcy5fb3B0aW9ucy5wb3NpdGlvbiB8fCB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhjbGFzc0xvY2tlZCkgfHwgdGhpcy5fbW91c2VPdmVyKTtcclxuICAgICAgICBpZiAoc2hvdykge1xyXG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NIaWRkZW4pO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX21vdXNlT3ZlcikgdGhpcy5fdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuaGlkZSgpIH0sIHRoaXMuX29wdGlvbnMuZGVsYXkpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fdGltZW91dElkID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NIaWRkZW4pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfc2V0T3B0aW9uSW50KG9wdGlvbiwgYXR0cikge1xyXG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuX2VsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHIpO1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zW29wdGlvbl0gPSBwYXJzZUludCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuLy8gR2xvYmFsc1xyXG4vLyAtLS0tLS0tXHJcblxyXG53aW5kb3cuSGlkZU9uU2Nyb2xsID0gSGlkZU9uU2Nyb2xsOyJdfQ=="}